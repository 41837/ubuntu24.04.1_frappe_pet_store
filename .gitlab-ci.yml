image: alpine:latest  # ใช้ Alpine Linux เป็น environment

before_script:
  - apk add --no-cache git
  - git --version
  - git config --global user.name "GitLab CI"
  - git config --global user.email "gitlab-ci@localhost"

stages:
  - sync

sync_repo:
  stage: sync
  script:
    # ลบ remote origin (ถ้ามี) และเพิ่มใหม่ให้เป็น GitHub
    - git remote remove origin || true
    - git remote add origin https://oauth2:${GITHUB_TOKEN}@github.com/41837/ubuntu24.04.1_frappe_pet_store.git

    # ดึงโค้ดจาก GitHub main
    - git fetch origin main
    - git checkout main || git checkout -b main origin/main

    # Push โค้ดไปที่ GitLab develop
    - git remote add gitlab https://oauth2:${GITLAB_TOKEN}@gitlab.srisawadpower.com/frappe/training/pet_store.git || true
    - git push gitlab main:develop
  only:
    - schedules  # ให้ทำงานเฉพาะ Schedule เท่านั้น